pipeline{
 agent any 
 
 tools{
 maven 'maven3.8.4'
 
 }

 triggers {
  pollSCM '* * * * *'
}

options {
	// add timestamp console output
  timestamps()
  //discard old build
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')
}

options {
	//discard old build
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5')
}


 
 
 stages {
 
	//Get the code from git hub 
    stage('checkoutclose'){
	steps {
git branch: 'development', credentialsId: 'ee92b6d4-9f69-4d40-a2e3-b408a7e13442', url: 'https://github.com/mss-social-app/maven-web-application-1.git'
}		
	}
    //Build the tools 
	stage ('build'){
	steps {
	sh "mvn clean package"		
	}	
	}
	 //sonarqube report 
	stage ('sonarQube report'){
	steps {
	sh "mvn clean sonar:sonar "		
	}	
	}
	
    //upload artifacts into nexus server 
	stage ('Artifacts into nexus){
	steps {
	sh "mvn clean deploy"		
	}	
	}

    //deploy tomcat 
    stage ('deploy application tomcat server'){
	steps {
	 deploy adapters: [tomcat9(credentialsId: '3f75ffd9-ee98-4c5f-b776-f7e35eaf9a5a', path: '', url: 'http://192.168.137.209:9987/')], contextPath: null, war: '**/maven-web-application.war'		
	}	
	}
	
 }//stages closing
 //mow we need to send the email notifaction after stage do this in stepn genrater go to directives select post"post stage or build select when we to send notification
 
 post {
  always {
     emailext body: '''Build over

    number 9987341848
    regard akash yadav''', subject: 'build over', to: 'yadav.akash6969@gmail.com'
  }
  success {
     emailext body: '''Build over

    number 9987341848
    regard akash yadav''', subject: 'build over', to: 'yadav.akash6969@gmail.com'
  }
  failure {
     emailext body: '''Build over

    number 9987341848
    regard akash yadav''', subject: 'build over', to: 'yadav.akash6969@gmail.com'
  }
}

 
 
 
 
} //pipeline closing
